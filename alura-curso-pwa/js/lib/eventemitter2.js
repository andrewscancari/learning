!function(e){var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=10;function s(){this._events={},this._conf&&n.call(this,this._conf)}function n(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function r(e){this._events={},this.newListener=!1,n.call(this,e)}function l(e,t,i,s){if(!i)return[];var n,r,o,h,a,c,f,_=[],p=t.length,u=t[s],v=t[s+1];if(s===p&&i._listeners){if("function"==typeof i._listeners)return e&&e.push(i._listeners),[i];for(n=0,r=i._listeners.length;n<r;n++)e&&e.push(i._listeners[n]);return[i]}if("*"===u||"**"===u||i[u]){if("*"===u){for(o in i)"_listeners"!==o&&i.hasOwnProperty(o)&&(_=_.concat(l(e,t,i[o],s+1)));return _}if("**"===u){for(o in(f=s+1===p||s+2===p&&"*"===v)&&i._listeners&&(_=_.concat(l(e,t,i,p))),i)"_listeners"!==o&&i.hasOwnProperty(o)&&("*"===o||"**"===o?(i[o]._listeners&&!f&&(_=_.concat(l(e,t,i[o],p))),_=_.concat(l(e,t,i[o],s))):_=o===v?_.concat(l(e,t,i[o],s+2)):_.concat(l(e,t,i[o],s)));return _}_=_.concat(l(e,t,i[u],s+1))}if((h=i["*"])&&l(e,t,h,s+1),a=i["**"])if(s<p)for(o in a._listeners&&l(e,t,a,p),a)"_listeners"!==o&&a.hasOwnProperty(o)&&(o===v?l(e,t,a[o],s+2):o===u?l(e,t,a[o],s+1):((c={})[o]=a[o],l(e,t,{"**":c},s+1)));else a._listeners?l(e,t,a,p):a["*"]&&a["*"]._listeners&&l(e,t,a["*"],p);return _}r.EventEmitter2=r,r.prototype.delimiter=".",r.prototype.setMaxListeners=function(e){this._events||s.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},r.prototype.event="",r.prototype.once=function(e,t){return this.many(e,1,t),this},r.prototype.many=function(e,t,i){var s=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");function n(){0==--t&&s.off(e,n),i.apply(this,arguments)}return n._origin=i,this.on(e,n),s},r.prototype.emit=function(){this._events||s.call(this);var e,t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var i=arguments.length,n=new Array(i-1),r=1;r<i;r++)n[r-1]=arguments[r];for(r=0,i=this._all.length;r<i;r++)this.event=t,this._all[r].apply(this,[t].concat(n))}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(this.wildcard){e=[];var o="string"==typeof t?t.split(this.delimiter):t.slice();l.call(this,e,o,this.listenerTree,0)}else e=this._events[t];if("function"==typeof e){if(this.event=t,1===arguments.length)e.call(this);else if(arguments.length>1)switch(arguments.length){case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,n=new Array(i-1),r=1;r<i;r++)n[r-1]=arguments[r];e.apply(this,n)}return!0}if(e){for(i=arguments.length,n=new Array(i-1),r=1;r<i;r++)n[r-1]=arguments[r];var h=e.slice();for(r=0,i=h.length;r<i;r++)this.event=t,h[r].apply(this,n);return h.length>0||!!this._all}return!!this._all},r.prototype.emitAsync=function(){this._events||s.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,i=[];if(this._all){for(var n=arguments.length,r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];for(o=0,n=this._all.length;o<n;o++)this.event=e,i.push(this._all[o].apply(this,r))}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");if(this.wildcard){t=[];var h="string"==typeof e?e.split(this.delimiter):e.slice();l.call(this,t,h,this.listenerTree,0)}else t=this._events[e];if("function"==typeof t){if(this.event=e,1===arguments.length)i.push(t.call(this));else if(arguments.length>1)switch(arguments.length){case 2:i.push(t.call(this,arguments[1]));break;case 3:i.push(t.call(this,arguments[1],arguments[2]));break;default:for(n=arguments.length,r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];i.push(t.apply(this,r))}}else if(t){for(n=arguments.length,r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];var a=t.slice();for(o=0,n=a.length;o<n;o++)this.event=e,i.push(a[o].apply(this,r))}return Promise.all(i)},r.prototype.on=function(e,n){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||s.call(this),this.emit("newListener",e,n),this.wildcard)return function(e,s){for(var n=0,r=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;n+1<r;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var l=this.listenerTree,o=e.shift();o;){if(l[o]||(l[o]={}),l=l[o],0===e.length){if(l._listeners){if("function"==typeof l._listeners)l._listeners=[l._listeners,s];else if(t(l._listeners)&&(l._listeners.push(s),!l._listeners.warned)){var h=i;void 0!==this._events.maxListeners&&(h=this._events.maxListeners),h>0&&l._listeners.length>h&&(l._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",l._listeners.length),console.trace&&console.trace())}}else l._listeners=s;return!0}o=e.shift()}return!0}.call(this,e,n),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],n];else if(t(this._events[e])&&(this._events[e].push(n),!this._events[e].warned)){var r=i;void 0!==this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace&&console.trace())}}else this._events[e]=n;return this},r.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},r.prototype.addListener=r.prototype.on,r.prototype.off=function(i,s){if("function"!=typeof s)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var o="string"==typeof i?i.split(this.delimiter):i.slice();r=l.call(this,null,o,this.listenerTree,0)}else{if(!this._events[i])return this;n=this._events[i],r.push({_listeners:n})}for(var h=0;h<r.length;h++){var a=r[h];if(n=a._listeners,t(n)){for(var c=-1,f=0,_=n.length;f<_;f++)if(n[f]===s||n[f].listener&&n[f].listener===s||n[f]._origin&&n[f]._origin===s){c=f;break}if(c<0)continue;return this.wildcard?a._listeners.splice(c,1):this._events[i].splice(c,1),0===n.length&&(this.wildcard?delete a._listeners:delete this._events[i]),this.emit("removeListener",i,s),this}(n===s||n.listener&&n.listener===s||n._origin&&n._origin===s)&&(this.wildcard?delete a._listeners:delete this._events[i],this.emit("removeListener",i,s))}return function t(i){if(i!==e){var s=Object.keys(i);for(var n in s){var r=s[n],l=i[r];l instanceof Function||"object"!=typeof l||(Object.keys(l).length>0&&t(i[r]),0===Object.keys(l).length&&delete i[r])}}}(this.listenerTree),this},r.prototype.offAny=function(e){var t,i=0,s=0;if(e&&this._all&&this._all.length>0){for(i=0,s=(t=this._all).length;i<s;i++)if(e===t[i])return t.splice(i,1),this.emit("removeListenerAny",e),this}else{for(i=0,s=(t=this._all).length;i<s;i++)this.emit("removeListenerAny",t[i]);this._all=[]}return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||s.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),i=l.call(this,null,t,this.listenerTree,0),n=0;n<i.length;n++){i[n]._listeners=null}else{if(!this._events||!this._events[e])return this;this._events[e]=null}return this},r.prototype.listeners=function(e){if(this.wildcard){var i=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return l.call(this,i,n,this.listenerTree,0),i}return this._events||s.call(this),this._events[e]||(this._events[e]=[]),t(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return r}):"object"==typeof exports?module.exports=r:window.EventEmitter2=r}();